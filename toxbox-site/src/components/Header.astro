---
import type { Props } from "@astrojs/starlight/props";
import Search from "@astrojs/starlight/components/Search.astro";
import SiteTitle from "@astrojs/starlight/components/SiteTitle.astro";
import ThemeSelect from "@astrojs/starlight/components/ThemeSelect.astro";

const base = import.meta.env.BASE_URL;
const boothUrl = "https://simijimishijimi.booth.pm/items/7592348";

// 現在のパスを取得してアクティブ状態を判定
const currentPath = Astro.url.pathname;
const isHome = currentPath === base || currentPath === `${base}index.html`;
const isDocs = currentPath.startsWith(`${base}docs/`) && !currentPath.includes('/releases');
const isReleases = currentPath.includes('/releases');
---

<div class="header sl-flex">
  <div class="sl-flex header-left">
    <SiteTitle {...Astro.props} />
    <div class="sl-hidden md:sl-flex">
      <ThemeSelect {...Astro.props} />
    </div>
  </div>

  <div class="sl-flex header-center">
    <Search {...Astro.props} />
  </div>

  <div class="sl-flex header-right">
    <nav class="header-links sl-hidden md:sl-flex">
      <a class:list={["header-link", { active: isHome }]} href={base}>ホーム</a>
      <a class:list={["header-link", { active: isDocs }]} href={`${base}docs/concept/`}>ドキュメント</a>
      <a class:list={["header-link", { active: isReleases }]} href={`${base}docs/releases/`}>リリースノート</a>
    </nav>
    <a class="header-cta" href={boothUrl} target="_blank" rel="noopener noreferrer">
      <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-6-2c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2zm6 16H6V8h2v2c0 .55.45 1 1 1s1-.45 1-1V8h4v2c0 .55.45 1 1 1s1-.45 1-1V8h2v12z"/></svg>
      <span class="cta-text">BOOTHで入手</span>
    </a>
  </div>
</div>

<style>
  .header {
    gap: 1rem;
    justify-content: space-between;
    align-items: center;
    height: 100%;
  }

  .header-left {
    align-items: center;
    gap: 1.5rem;
  }

  .header-links {
    gap: 1.5rem;
    align-items: center;
  }

  .header-link {
    font-size: 0.875rem;
    color: var(--sl-color-gray-2);
    text-decoration: none;
    transition: color 0.2s;
    white-space: nowrap;
  }

  .header-link:hover {
    color: var(--sl-color-white);
  }

  .header-link.active {
    color: var(--sl-color-white);
    border-bottom: 2px solid var(--sl-color-white);
    padding-bottom: 2px;
  }

  :global([data-theme="light"]) .header-link {
    color: var(--sl-color-gray-3);
  }

  :global([data-theme="light"]) .header-link:hover {
    color: var(--sl-color-black);
  }

  :global([data-theme="light"]) .header-link.active {
    color: var(--sl-color-black);
    border-bottom-color: var(--sl-color-black);
  }

  .header-center {
    flex: 1;
    justify-content: center;
    max-width: 300px;
  }

  .header-right {
    gap: 1.5rem;
    align-items: center;
  }

  .header-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.5rem 1rem;
    background: #FC4D50;
    color: #fff;
    font-size: 0.875rem;
    font-weight: 600;
    border-radius: 6px;
    text-decoration: none;
    transition: background 0.2s;
    white-space: nowrap;
  }

  .header-cta:hover {
    background: #e63e41;
  }

  .header-cta svg {
    width: 14px;
    height: 14px;
    fill: currentColor;
  }

  @media (max-width: 50rem) {
    .header {
      gap: 0.75rem;
    }

    .header-center {
      flex: 1;
      max-width: none;
    }

    .cta-text {
      display: none;
    }

    .header-cta {
      padding: 0.5rem;
    }
  }
</style>
